<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lpl.mybatis.mapper.StudentMapper">
    <!--
      需求： 需要获取所有学生对应的老师信息
      思路：
        1.获取所有学生的信息
        2.根据获取的学生信息的老师ID->获取该老师的信息
        3.这样学生的结果集中应该包含老师，该如何处理？
            1. 做一个结果映射集 StudentTeacher
            2. StudentTeacher结果集的类型为Student
            3. 学生中老师的属性为Teacher,对应数据库的tid
            4. association – 一个复杂类型的关联；使用它来处理关联查询
    -->

    <!-- 按照查询嵌套处理 -->
    <select id="getStudents" resultMap="StudentTeacher">
        select `id`,`name`,`tid` from `student`
    </select>

    <resultMap id="StudentTeacher" type="com.lpl.mybatis.domain.Student">
        <!--
            association -> 对象
            collection -> 集合
        -->
        <!-- association关联属性 property属性名  javaType属性类型  column在多的一方的表中的列名 -->
        <association property="teacher" javaType="com.lpl.mybatis.domain.Teacher" column="tid" select="getTeacher"/>
    </resultMap>


    <!--
        这里传递过来的id，只有一个属性的时候，下面可以写任何值
        association中column多参数配置：
            column = "{key=value,key=value}"
            其实就是键值对的形式，key是传给下个sql的取值名称，value是片段一中sql查询的字段名
    -->
    <select id="getTeacher" resultType="com.lpl.mybatis.domain.Teacher">
        select `id`,`name` from `teacher` where `id` = #{tid}
    </select>



    <!--  按照查询结果嵌套处理 -->
    <select id="getStudents2" resultMap="StudentTeacher2">
        select s.id sid, s.name sname ,s.tid, t.name tname
        from student s,teacher t
        where s.tid = t.id
    </select>

    <resultMap id="StudentTeacher2" type="Student">
        <id property="id" column="sid"/>
        <result property="name" column="sname"/>
        <!--   关联对象property 关联对象在Student实体类中的属性  -->
        <association property="teacher" javaType="Teacher">
            <result property="name" column="tname"/>
            <result property="id" column="tid"/>
        </association>
    </resultMap>
</mapper>